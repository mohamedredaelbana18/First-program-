# 💰 نظام عمولات السماسرة الجديد

## ✅ المميزات المضافة:

### 1. تتبع عمولات السماسرة ✅
**الوضع الحالي:** نظام جديد مكتمل
- **تسجيل العمولات:** عند إنشاء العقد، يتم تسجيل عمولة السمسار
- **حالة العمولة:** pending (مستحقة) أو paid (مدفوعة)
- **تفاصيل كاملة:** اسم السمسار، كود العقد، العميل، المبلغ، الخزنة

### 2. صفحة عمولات السماسرة ✅
**الوضع الحالي:** محسنة ومحدثة
- **تبويب العمولات المستحقة:** عرض جميع العمولات غير المدفوعة
- **إحصائيات:** إجمالي العمولات المستحقة والمدفوعة
- **أزرار الدفع:** دفع العمولة مباشرة من الصفحة

### 3. نظام دفع العمولات ✅
**الوضع الحالي:** نظام متكامل
- **التحقق من الرصيد:** التأكد من كفاية رصيد الخزنة
- **إنشاء سند دفع:** تلقائياً عند الدفع
- **تحديث الحالة:** تغيير حالة العمولة إلى مدفوعة
- **إشعارات:** تأكيد نجاح العملية

### 4. تقرير عمولات السماسرة ✅
**الوضع الحالي:** تقرير جديد
- **الموقع:** تبويب التقارير → المتابعة
- **المحتوى:**
  - العمولات المستحقة لكل سمسار
  - العمولات المدفوعة لكل سمسار
  - إجمالي العمولات لكل سمسار

## 🛠️ كيفية العمل:

### 1. عند إنشاء العقد:
```javascript
// تتبع عمولة السمسار
if (brokerAmt > 0) {
    trackBrokerCommission(contract.id, brokerName, brokerAmt);
}
```

### 2. عند دفع العمولة:
```javascript
// دفع عمولة السمسار
payBrokerCommission(commissionId);
```

### 3. بنية البيانات:
```javascript
const commissionRecord = {
    id: uid('BC'),
    brokerId: broker.id,
    brokerName: brokerName,
    contractId: contractId,
    contractCode: contract.code,
    amount: amount,
    status: 'pending', // pending, paid
    dueDate: contract.start,
    paymentDate: null,
    safeId: contract.commissionSafeId,
    description: `عمولة عقد ${contract.code}`,
    unitId: contract.unitId,
    customerName: customerName
};
```

## 📊 التقارير المتاحة:

### 1. صفحة السماسرة - تبويب العمولات المستحقة:
- **إحصائيات سريعة:**
  - إجمالي العمولات المستحقة
  - إجمالي العمولات المدفوعة
  - عدد العمولات لكل حالة

- **جدول العمولات:**
  - اسم السمسار
  - كود العقد
  - اسم العميل
  - تاريخ الاستحقاق
  - المبلغ
  - الخزنة
  - زر الدفع

### 2. تقرير عمولات السماسرة:
- **إحصائيات لكل سمسار:**
  - العمولات المستحقة
  - عدد العمولات المستحقة
  - العمولات المدفوعة
  - عدد العمولات المدفوعة
  - إجمالي العمولات

## 🎨 تحسينات واجهة المستخدم:

### 1. تصميم صفحة السماسرة:
- **تبويبات:** قائمة السماسرة / العمولات المستحقة
- **بطاقات إحصائية:** عرض الإحصائيات بشكل واضح
- **جدول تفاعلي:** أزرار دفع مباشرة

### 2. ألوان وتصميم:
- **الألوان:** ألوان مميزة للإحصائيات
- **التخطيط:** تصميم متجاوب
- **الأيقونات:** أيقونات واضحة

## 📋 كيفية الاستخدام:

### 1. إنشاء عقد مع سمسار:
1. اذهب إلى تبويب "العقود"
2. اختر سمسار وأدخل نسبة العمولة
3. اختر خزنة العمولة
4. انقر "حفظ + توليد أقساط"
5. سيتم تسجيل العمولة تلقائياً

### 2. دفع عمولة سمسار:
1. اذهب إلى تبويب "السماسرة"
2. انقر على تبويب "العمولات المستحقة"
3. انقر "دفع الآن" بجانب العمولة المطلوبة
4. سيتم خصم المبلغ من الخزنة وإنشاء سند دفع

### 3. عرض تقرير العمولات:
1. اذهب إلى تبويب "التقارير"
2. اختر "المتابعة"
3. انقر "عمولات السماسرة"

## 🔧 الملفات المحدثة:

### 1. `app.js`:
- `trackBrokerCommission()` - تتبع عمولات السماسرة
- `payBrokerCommission()` - دفع عمولات السماسرة
- `generateBrokerCommissionsReport()` - تقرير العمولات
- تحديث `renderBrokers()` - صفحة السماسرة المحسنة

### 2. `app/globals.css`:
- أنماط CSS للبطاقات الإحصائية
- أنماط CSS للتبويبات
- تحسين تصميم الجداول

## 🎯 المميزات الرئيسية:

### ✅ **تتبع تلقائي:**
- تسجيل العمولات عند إنشاء العقد
- لا يتم الدفع تلقائياً
- إمكانية الدفع لاحقاً

### ✅ **إدارة شاملة:**
- عرض جميع العمولات المستحقة
- إحصائيات مفصلة
- أزرار دفع مباشرة

### ✅ **تقارير متقدمة:**
- تقرير مفصل لعمولات كل سمسار
- إحصائيات المستحقة والمدفوعة
- إمكانية الطباعة والتصدير

### ✅ **أمان وموثوقية:**
- التحقق من رصيد الخزنة
- إنشاء سندات دفع تلقائياً
- تتبع كامل للعمليات

## 🔄 التحديثات المستقبلية:

- [ ] إشعارات تلقائية للعمولات المستحقة
- [ ] تقارير شهرية وسنوية
- [ ] تصدير التقارير لـ Excel
- [ ] نظام تنبيهات للسماسرة
- [ ] رسوم بيانية للإحصائيات

## 📊 البيانات الجديدة:

### في قاعدة البيانات:
- `brokerCommissions`: سجل عمولات السماسرة
- `vouchers`: سندات دفع العمولات

### الحقول الجديدة:
- `status`: حالة العمولة (pending/paid)
- `paymentDate`: تاريخ الدفع
- `contractCode`: كود العقد
- `customerName`: اسم العميل

---

**🏆 نظام عمولات السماسرة جاهز للاستخدام!**