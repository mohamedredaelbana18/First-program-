# مدير الاستثمار العقاري - Real Estate Investment Manager

## 🚀 تم إصلاح المشاكل التالية:

### ✅ المشاكل التي تم حلها:
1. **عدم وجود ملف `.env`** - تم إنشاؤه مع متغيرات البيئة المطلوبة
2. **عدم تثبيت التبعيات** - تم تثبيت جميع التبعيات
3. **مشاكل في قاعدة البيانات** - تم إعداد Prisma وتحديثه
4. **أخطاء في الكود** - تم إصلاح أخطاء catch blocks
5. **مشاكل في ESLint** - تم تحديث التبعيات

## 📋 المتطلبات:

- Node.js 18+ 
- PostgreSQL database (Neon, Render, أو Vercel Postgres)
- npm أو yarn

## 🛠️ التثبيت والإعداد:

### 1. تثبيت التبعيات:
```bash
npm install
```

### 2. إعداد قاعدة البيانات:
```bash
# إنشاء ملف .env (تم إنشاؤه تلقائياً)
cp .env.example .env

# تحديث متغيرات البيئة في ملف .env
# DATABASE_URL - رابط قاعدة البيانات PostgreSQL
# NEXTAUTH_SECRET - مفتاح التشفير
# NEXTAUTH_URL - رابط التطبيق

# مزامنة قاعدة البيانات
npx prisma db push

# توليد Prisma Client
npx prisma generate
```

### 3. تشغيل التطبيق:
```bash
# وضع التطوير
npm run dev

# بناء للإنتاج
npm run build

# تشغيل الإنتاج
npm start
```

## 🔧 الأوامر المتاحة:

```bash
# تطوير
npm run dev

# بناء
npm run build

# تشغيل
npm start

# فحص الأخطاء
npm run lint

# قاعدة البيانات
npm run db:generate    # توليد Prisma Client
npm run db:push        # مزامنة قاعدة البيانات
npm run db:migrate     # إنشاء migration جديد
npm run db:studio      # فتح Prisma Studio
npm run db:seed        # إضافة بيانات تجريبية

# توليد مفتاح تشفير
npm run generate-secret
```

## 🗄️ قاعدة البيانات:

التطبيق يستخدم PostgreSQL مع Prisma ORM. المخطط يتضمن:

- **العملاء** - بيانات العملاء
- **الوحدات** - الوحدات العقارية
- **العقود** - عقود البيع والإيجار
- **الأقساط** - جدول الأقساط
- **الشركاء** - شركاء الاستثمار
- **الخزنة** - إدارة الأموال
- **السندات** - سندات القبض والدفع
- **السماسرة** - بيانات السماسرة

## 🚨 ملاحظات مهمة:

1. **الثغرات الأمنية**: هناك 3 ثغرات أمنية في التبعيات:
   - `dompurify` - ثغرة XSS متوسطة
   - `xlsx` - ثغرة Prototype Pollution عالية
   - `xlsx` - ثغرة ReDoS عالية

2. **الحلول المقترحة**:
   - تحديث `jspdf` إلى أحدث إصدار
   - البحث عن بديل لـ `xlsx` أو انتظار إصلاح

## 🌐 النشر:

### Vercel:
1. ربط المشروع بـ Vercel
2. إضافة متغيرات البيئة
3. النشر التلقائي

### Render:
1. إنشاء Web Service
2. ربط قاعدة البيانات PostgreSQL
3. إضافة متغيرات البيئة

## 📞 الدعم:

إذا واجهت أي مشاكل:
1. تحقق من ملف `.env`
2. تأكد من صحة رابط قاعدة البيانات
3. شغل `npm run lint` للتحقق من الأخطاء
4. تحقق من سجلات الخطأ في وحدة التحكم

## 🔄 التحديثات المستقبلية:

- [ ] إصلاح الثغرات الأمنية
- [ ] تحسين الأداء
- [ ] إضافة المزيد من التقارير
- [ ] تحسين واجهة المستخدم